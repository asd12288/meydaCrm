# =============================================================================
# Supabase Project Configuration
# Pulse CRM - config.toml for Branching + GitHub Integration
# =============================================================================

project_id = "owwyxrxojltmupqrvqcp"

# =============================================================================
# API Configuration
# =============================================================================

[api]
enabled = true
port = 54321
schemas = ["public", "storage", "graphql_public"]
extra_search_path = ["public", "extensions"]
max_rows = 1000

# =============================================================================
# Database Configuration
# =============================================================================

[db]
port = 54322
shadow_port = 54320
major_version = 17

[db.pooler]
enabled = false
port = 54329
pool_mode = "transaction"
default_pool_size = 20
max_client_conn = 100

# Seed configuration - runs on preview branch creation
[db.seed]
enabled = true
sql_paths = ["seed.sql"]

# =============================================================================
# Studio Configuration (Local Development)
# =============================================================================

[studio]
enabled = true
port = 54323
api_url = "http://127.0.0.1"

# =============================================================================
# Inbucket (Local Email Testing)
# =============================================================================

[inbucket]
enabled = true
port = 54324
smtp_port = 54325
pop3_port = 54326

# =============================================================================
# Storage Configuration
# =============================================================================

[storage]
enabled = true
file_size_limit = "50MiB"

[storage.image_transformation]
enabled = true

# Storage buckets
[storage.buckets.imports]
public = false
file_size_limit = "50MiB"
allowed_mime_types = ["text/csv", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", "application/vnd.ms-excel"]

[storage.buckets.avatars]
public = true
file_size_limit = "5MiB"
allowed_mime_types = ["image/jpeg", "image/png", "image/gif", "image/webp"]

[storage.buckets.exports]
public = false
file_size_limit = "100MiB"
allowed_mime_types = ["text/csv", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]

# =============================================================================
# Auth Configuration
# =============================================================================

[auth]
enabled = true
site_url = "env(SITE_URL)"
additional_redirect_urls = ["http://localhost:3000/**", "https://*.vercel.app/**"]
jwt_expiry = 3600
# IMPORTANT: No self-signup - admin creates users only
enable_signup = false
enable_anonymous_sign_ins = false
minimum_password_length = 6

[auth.email]
# enable_signup enables email/password LOGIN (not just signup)
# We still control public signup via [auth].enable_signup = false
enable_signup = true
enable_confirmations = false
double_confirm_changes = false

[auth.sms]
enable_signup = false
enable_confirmations = false

[auth.mfa]
max_enrolled_factors = 0

[auth.sessions]
timebox = 86400
inactivity_timeout = 3600

# =============================================================================
# Realtime Configuration
# =============================================================================

[realtime]
enabled = true
ip_version = 4
max_header_length = 4096

# =============================================================================
# Analytics Configuration
# =============================================================================

[analytics]
enabled = false

# =============================================================================
# Edge Functions Configuration
# =============================================================================
# NOTE: Edge Functions are deployed via GitHub Actions (.github/workflows/supabase-preview.yml)
# We removed the [functions.*] declarations here because:
# 1. Supabase auto-deployment from config.toml was failing on preview branches
# 2. Our GitHub Action deploys functions via CLI with explicit --no-verify-jwt flags
# 3. This prevents the "FUNCTIONS_FAILED" status on Supabase Preview checks
#
# Function JWT settings (enforced via CLI deployment):
# - admin-create-user: verify_jwt = true
# - admin-reset-password: verify_jwt = true
# - admin-delete-user: verify_jwt = true
# - subscription-webhook: verify_jwt = false
# =============================================================================
# Production Remote Configuration
# =============================================================================

[remotes.production]
project_id = "owwyxrxojltmupqrvqcp"

[remotes.production.api]
max_rows = 1000

# Production does NOT run seed.sql
[remotes.production.db.seed]
enabled = false
